(function(e,t){"use strict";function a(e,t){this.container=e;this.options=t;this.init()}function f(t,n){this.widget=t;this.options=e.extend({},n);this.detectService();if(this.service){this.init()}}function l(e){function t(e,t){return t.toUpper()}var n={};var r=e.data();for(var i in r){var s=r[i];if(s==="yes")s=true;else if(s==="no")s=false;n[i.replace(/-(\w)/g,t)]=s}return n}function c(e,t){return h(e,t,encodeURIComponent)}function h(e,t,n){return e.replace(/\{([^\}]+)\}/g,function(e,r){return r in t?n?n(t[r]):t[r]:e})}function p(e,t){var n=r+e;return n+" "+n+"_"+t}function d(t,n){function r(u){if(u.type==="keydown"&&u.which!==27||e(u.target).closest(t).length)return;t.removeClass(i);s.off(o,r);if(e.isFunction(n))n()}var s=e(document);var o="click touchstart keydown";s.on(o,r)}function v(e){var t=10;if(document.documentElement.getBoundingClientRect){var n=parseInt(e.css("left"),10);var r=parseInt(e.css("top"),10);var s=e[0].getBoundingClientRect();if(s.left<t)e.css("left",t-s.left+n);else if(s.right>window.innerWidth-t)e.css("left",window.innerWidth-s.right-t+n);if(s.top<t)e.css("top",t-s.top+r);else if(s.bottom>window.innerHeight-t)e.css("top",window.innerHeight-s.bottom-t+r)}e.addClass(i)}var n="social-likes";var r=n+"__";var i=n+"_opened";var s=location.protocol==="https:"?"https:":"http:";var o={facebook:{counterUrl:"https://graph.facebook.com/fql?q=SELECT+total_count+FROM+link_stat+WHERE+url%3D%22{url}%22&callback=?",convertNumber:function(e){return e.data[0].total_count},popupUrl:"https://www.facebook.com/sharer/sharer.php?u={url}",popupWidth:600,popupHeight:500},twitter:{counterUrl:s+"//urls.api.twitter.com/1/urls/count.json?url={url}&callback=?",convertNumber:function(e){return e.count},popupUrl:s+"//twitter.com/intent/tweet?url={url}&text={title}",popupWidth:600,popupHeight:450,click:function(){if(!/[\.:\-–—]\s*$/.test(this.options.title))this.options.title+=":";return true}},mailru:{counterUrl:s+"//connect.mail.ru/share_count?url_list={url}&callback=1&func=?",convertNumber:function(e){for(var t in e){if(e.hasOwnProperty(t)){return e[t].shares}}},popupUrl:s+"//connect.mail.ru/share?share_url={url}&title={title}",popupWidth:550,popupHeight:360},vkontakte:{counterUrl:s+"//vk.com/share.php?act=count&url={url}&index={index}",counter:function(t,n){var r=o.vkontakte;if(!r._){r._=[];if(!window.VK)window.VK={};window.VK.Share={count:function(e,t){r._[e].resolve(t)}}}var i=r._.length;r._.push(n);e.getScript(c(t,{index:i})).fail(n.reject)},popupUrl:s+"//vk.com/share.php?url={url}&title={title}",popupWidth:550,popupHeight:330},odnoklassniki:{counterUrl:s+"//www.odnoklassniki.ru/dk?st.cmd=shareData&ref={url}&cb=?",convertNumber:function(e){return e.count},popupUrl:s+"//www.odnoklassniki.ru/dk?st.cmd=addShare&st._surl={url}",popupWidth:550,popupHeight:360},plusone:{counterUrl:s+"//share.yandex.ru/gpp.xml?url={url}",counter:function(t,n){var r=o.plusone;if(r._){n.reject();return}if(!window.services)window.services={};window.services.gplus={cb:function(e){r._.resolve(e)}};r._=n;e.getScript(c(t)).fail(n.reject)},popupUrl:"https://plus.google.com/share?url={url}",popupWidth:700,popupHeight:500},pinterest:{counterUrl:s+"//api.pinterest.com/v1/urls/count.json?url={url}&callback=?",convertNumber:function(e){return e.count},popupUrl:s+"//pinterest.com/pin/create/button/?url={url}&description={title}",popupWidth:630,popupHeight:270}};var u={promises:{},fetch:function(t,n,r){if(!u.promises[t])u.promises[t]={};var i=u.promises[t];if(!r.forceUpdate&&i[n]){return i[n]}else{var s=e.extend({},o[t],r);var a=e.Deferred();var f=s.counterUrl&&c(s.counterUrl,{url:n});if(e.isFunction(s.counter)){s.counter(f,a)}else if(s.counterUrl){e.getJSON(f).done(function(t){try{var n=t;if(e.isFunction(s.convertNumber)){n=s.convertNumber(t)}a.resolve(n)}catch(r){a.reject()}}).fail(a.reject)}else{a.reject()}i[n]=a.promise();return i[n]}}};e.fn.socialLikes=function(t){return this.each(function(){var r=e(this);var i=r.data(n);if(i){if(e.isPlainObject(t)){i.update(t)}}else{i=new a(r,e.extend({},e.fn.socialLikes.defaults,t,l(r)));r.data(n,i)}})};e.fn.socialLikes.defaults={url:window.location.href.replace(window.location.hash,""),title:document.title,counters:true,zeroes:false,wait:500,popupCheckInterval:500,singleTitle:"Share"};a.prototype={init:function(){this.container.addClass(n);this.single=this.container.hasClass(n+"_single");this.initUserButtons();this.number=0;this.container.on("counter."+n,e.proxy(this.updateCounter,this));var t=this.container.children();this.countersLeft=t.length;this.makeSingleButton();this.buttons=[];t.each(e.proxy(function(t,n){this.buttons.push(new f(e(n),this.options))},this));if(this.options.counters){this.timer=setTimeout(e.proxy(this.appear,this),this.options.wait)}else{this.appear()}},initUserButtons:function(){if(!this.userButtonInited&&window.socialLikesButtons){e.extend(true,o,socialLikesButtons)}this.userButtonInited=true},makeSingleButton:function(){if(!this.single)return;var t=this.container;t.addClass(n+"_vertical");t.wrap(e("<div>",{"class":n+"_single-w"}));var r=t.parent();var i=e("<div>",{"class":p("widget","single")});var s=e(h('<div class="{buttonCls}">'+'<span class="{iconCls}"></span>'+"{title}"+"</div>",{buttonCls:p("button","single"),iconCls:p("icon","single"),title:this.options.singleTitle}));i.append(s);r.append(i);i.click(function(){var e=n+"__widget_active";i.addClass(e);t.css({left:-(t.width()-i.width())/2,top:-t.height()});v(t);d(t,function(){i.removeClass(e)});return false});this.widget=i},update:function(t){if(!t.forceUpdate&&t.url===this.options.url)return;this.number=0;this.countersLeft=this.buttons.length;if(this.widget)this.widget.find("."+n+"__counter").remove();e.extend(this.options,t);for(var r=0;r<this.buttons.length;r++){this.buttons[r].update(t)}},updateCounter:function(e,t,r){if(r){this.number+=r;if(this.single){this.getCounterElem().text(this.number)}}this.countersLeft--;if(this.countersLeft===0){this.appear();this.container.addClass(n+"_ready");this.container.trigger("ready."+n,this.number)}},appear:function(){this.container.addClass(n+"_visible")},getCounterElem:function(){var t=this.widget.find("."+r+"counter_single");if(!t.length){t=e("<span>",{"class":p("counter","single")});this.widget.append(t)}return t}};f.prototype={init:function(){this.detectParams();this.initHtml();this.initCounter()},update:function(t){e.extend(this.options,{forceUpdate:false},t);this.widget.find("."+n+"__counter").remove();this.initCounter()},detectService:function(){var t=this.widget[0].classList||this.widget[0].className.split(" ");for(var n=0;n<t.length;n++){var r=t[n];if(o[r]){this.service=r;e.extend(this.options,o[r]);return}}},detectParams:function(){var e=this.widget.data();if(e.counter){var t=parseInt(e.counter,10);if(isNaN(t)){this.options.counterUrl=e.counter}else{this.options.counterNumber=t}}if(e.title){this.options.title=e.title}if(e.url){this.options.url=e.url}},initHtml:function(){var t=this.options;var n=this.widget;var r=n.find("a");if(r.length){this.cloneDataAttrs(r,n)}var i=e("<span>",{"class":this.getElementClassNames("button"),text:n.text()});if(t.clickUrl){var s=c(t.clickUrl,{url:t.url,title:t.title});var o=e("<a>",{href:s});this.cloneDataAttrs(n,o);n.replaceWith(o);this.widget=n=o}else{n.click(e.proxy(this.click,this))}n.removeClass(this.service);n.addClass(this.getElementClassNames("widget"));i.prepend(e("<span>",{"class":this.getElementClassNames("icon")}));n.empty().append(i);this.button=i},initCounter:function(){if(this.options.counters){if(this.options.counterNumber){this.updateCounter(this.options.counterNumber)}else{var t={counterUrl:this.options.counterUrl,forceUpdate:this.options.forceUpdate};u.fetch(this.service,this.options.url,t).always(e.proxy(this.updateCounter,this))}}},cloneDataAttrs:function(e,t){var n=e.data();for(var r in n){if(n.hasOwnProperty(r)){t.data(r,n[r])}}},getElementClassNames:function(e){return p(e,this.service)},updateCounter:function(t){t=parseInt(t,10)||0;var r={"class":this.getElementClassNames("counter"),text:t};if(!t&&!this.options.zeroes){r["class"]+=" "+n+"__counter_empty";r.text=""}var i=e("<span>",r);this.widget.append(i);this.widget.trigger("counter."+n,[this.service,t])},click:function(t){var n=this.options;var r=true;if(e.isFunction(n.click)){r=n.click.call(this,t)}if(r){var i=c(n.popupUrl,{url:n.url,title:n.title});i=this.addAdditionalParamsToUrl(i);this.openPopup(i,{width:n.popupWidth,height:n.popupHeight})}return false},addAdditionalParamsToUrl:function(t){var n=e.param(e.extend(this.widget.data(),this.options.data));if(e.isEmptyObject(n))return t;var r=t.indexOf("?")===-1?"?":"&";return t+r+n},openPopup:function(t,r){var i=Math.round(screen.width/2-r.width/2);var s=0;if(screen.height>r.height){s=Math.round(screen.height/3-r.height/2)}var o=window.open(t,"sl_"+this.service,"left="+i+",top="+s+","+"width="+r.width+",height="+r.height+",personalbar=0,toolbar=0,scrollbars=1,resizable=1");if(o){o.focus();this.widget.trigger("popup_opened."+n,[this.service,o]);var u=setInterval(e.proxy(function(){if(!o.closed)return;clearInterval(u);this.widget.trigger("popup_closed."+n,this.service)},this),this.options.popupCheckInterval)}else{location.href=t}}};e(function(){console.log(n);e("."+n).socialLikes()})})($)